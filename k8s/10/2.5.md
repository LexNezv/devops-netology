# Домашнее задание к занятию «Helm»

### Цель задания

В тестовой среде Kubernetes необходимо установить и обновить приложения с помощью Helm.

------

### Чеклист готовности к домашнему заданию

1. Установленное k8s-решение, например, MicroK8S.
2. Установленный локальный kubectl.
3. Установленный локальный Helm.
4. Редактор YAML-файлов с подключенным репозиторием GitHub.

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Инструкция](https://helm.sh/docs/intro/install/) по установке Helm. [Helm completion](https://helm.sh/docs/helm/helm_completion/).

------

### Задание 1. Подготовить Helm-чарт для приложения

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
```
helm create project
```
2. Каждый компонент приложения деплоится отдельным deployment’ом или statefulset’ом.
3. В переменных чарта измените образ приложения для изменения версии.
>[Chart values](./project/values.yaml)

------
### Задание 2. Запустить две версии в разных неймспейсах

1. Подготовив чарт, необходимо его проверить. Запуститe несколько копий приложения.
2. Одну версию в namespace=app1, вторую версию в том же неймспейсе, третью версию в namespace=app2.
> Подготовка неймспейсов
```
$ kubectl create namespace app1
$ kubectl create namespace app2
```
> Деплой чарта
```
$ helm install test1 ./project -n app1   

NAME: test1
LAST DEPLOYED: Tue Jun  3 12:07:10 2025
NAMESPACE: app1
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace app1 -l "app.kubernetes.io/name=project,app.kubernetes.io/instance=test1" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace app1 $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace app1 port-forward $POD_NAME 8080:$CONTAINER_PORT
$ helm install test2 ./project -n app1

NAME: test2
LAST DEPLOYED: Tue Jun  3 12:07:21 2025
NAMESPACE: app1
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace app1 -l "app.kubernetes.io/name=project,app.kubernetes.io/instance=test2" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace app1 $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace app1 port-forward $POD_NAME 8080:$CONTAINER_PORT

$ helm install test3 ./project -n app2
NAME: test3
LAST DEPLOYED: Tue Jun  3 12:08:07 2025
NAMESPACE: app2
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace app2 -l "app.kubernetes.io/name=project,app.kubernetes.io/instance=test3" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace app2 $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace app2 port-forward $POD_NAME 8080:$CONTAINER_PORT
```
3. Продемонстрируйте результат.
```
$ kubectl get -n app1 all     
NAME                                 READY   STATUS    RESTARTS   AGE
pod/test1-project-84fd8595cc-67kj9   1/1     Running   0          100s
pod/test2-project-64fff57d98-xnwj8   1/1     Running   0          89s

NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
service/test1-project   ClusterIP   10.152.183.198   <none>        80/TCP    100s
service/test2-project   ClusterIP   10.152.183.118   <none>        80/TCP    89s

NAME                            READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/test1-project   1/1     1            1           100s
deployment.apps/test2-project   1/1     1            1           89s

NAME                                       DESIRED   CURRENT   READY   AGE
replicaset.apps/test1-project-84fd8595cc   1         1         1       100s
replicaset.apps/test2-project-64fff57d98   1         1         1       89s
$ kubectl get -n app2 all
NAME                                 READY   STATUS    RESTARTS   AGE
pod/test3-project-666f7bf595-9qq9t   1/1     Running   0          46s

NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
service/test3-project   ClusterIP   10.152.183.145   <none>        80/TCP    46s

NAME                            READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/test3-project   1/1     1            1           46s

NAME                                       DESIRED   CURRENT   READY   AGE
replicaset.apps/test3-project-666f7bf595   1         1         1       46s
```

### Правила приёма работы

1. Домашняя работа оформляется в своём Git репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд `kubectl`, `helm`, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.

