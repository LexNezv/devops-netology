# Домашнее задание к занятию «Компоненты Kubernetes»

### Цель задания

Рассчитать требования к кластеру под проект

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания:

- [Considerations for large clusters](https://kubernetes.io/docs/setup/best-practices/cluster-large/),
- [Architecting Kubernetes clusters — choosing a worker node size](https://learnk8s.io/kubernetes-node-size).

------

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:
> Так-как я не знаю в какой среде мы будем разворачиватся под "хост" подразумеваю сущность в виде виртуальной машины или baremetal или любой другой, невисимых в своей работе друг от друга, с определенным набором характеристик. Также дисковое пространство учтено не будет, т.к у нас нет информации об объемах приложений.
1. Необходимо упаковать приложение в чарт для деплоя в разные окружения.
> Тут можно выделить ресурс для хранения манифестов, деплоя и согласованности настроек в виде гитлаба + раннер. Можно установить на одном хосте, так же можно взять любые аналоги, но двнные выбираем, потому что там есть все что надо из коробки, даже хранилище образов при необходимости), пометим это как ресурсы со *, которые необязательны, но желательны.  + выделим окружения, например: staging, test, prod.
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
> Для отказоусточивости бд должен быть соблюден кворум. Тут не очень понятно надо ли нам 3 отказоустойчивых бд или это одна бд, которую уже распределили на 3 копии. Под это будет выделено 3 хоста по 8 ram и 2 сpu. Чтобы в случае выхода одного из хостов из строя база могла переехать на другую ноду. Так же это пригодится, создаст буфер в случае непредвиденного увеличения нагрузки на БД. + для бд я бы использовал внешний volume желатительно, а не хранил бд на нодах, поэтому + 1 хост под хранение без указания характеристик
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
> Аналогично предыдущему пункту, но делать отдельные ноды не требуется, поэтому добавляем на ноды еще по 6 Ram + 2 ядра. Таким образом при отключении одной из нод наши 3 экземлпляры кэша и базы данных смогут быть распределены на другие ноды. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
> У нас уже был заложен достаточный буфер в предыдущих пунктах, поэтому здесь ничего не прибавляем
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.
> Учитывая количество копий и текущее количество нод - увеличу количество нод и убавлю характеристики каждой ноды индивидуально. Таким образом позволит хранить разные запущенные экземпляры распределенно и выход одной ноды не будет для нас потерей больших мощностей. При этом я оставляю на каждой ноде люфт для возможного увеличения нагрузки и падения других нод. Так же это позволяет нам задеплоить нам в кластер инструменты из 1 пункта.
0. Этого пункта в задаче нет
> но хотелось бы вынести master ноды отдельно, как и безопасно настроить etcd, при этом такие ноды не должны потреблять много ресурсов, поэтому добавляем в кластер еще 3 ноды для управления.

----
## Итого
Обязательные:
- 5 worker node 8 ram 4 сpu
- 3 master node 2 ram 1 cpu
- Сетевое хранилище с raid (чтобы не потерять данные) или распределенная фс. В зависимости от бюджета и прочих факторов.
----

