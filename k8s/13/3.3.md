# Домашнее задание к занятию «Как работает сеть в K8s»

### Цель задания

Настроить сетевую политику доступа к подам.

### Чеклист готовности к домашнему заданию

1. Кластер K8s с установленным сетевым плагином Calico.

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Документация Calico](https://www.tigera.io/project-calico/).
2. [Network Policy](https://kubernetes.io/docs/concepts/services-networking/network-policies/).
3. [About Network Policy](https://docs.projectcalico.org/about/about-network-policy).

-----

### Задание 1. Создать сетевую политику или несколько политик для обеспечения доступа

1. Создать deployment'ы приложений frontend, backend и cache и соответсвующие сервисы.
2. В качестве образа использовать network-multitool.
[app](./app.yml)
3. Разместить поды в namespace App.
```
kubectl apply -n app -f app.yml
```
4. Создать политики, чтобы обеспечить доступ frontend -> backend -> cache. Другие виды подключений должны быть запрещены.
[policy](./policy.yml)
5. Продемонстрировать, что трафик разрешён и запрещён.
> frontend видим, что подключается к бэку и не подключается к кэшу
```
➜  ~ kubectl -n app exec -it network-multitool-frontend-6c5844b654-6hmnp -- curl http://network-multitool-backend:8080 
WBITT Network MultiTool (with NGINX) - network-multitool-backend-79bd4c5db8-bc2vj - 10.244.102.133 - HTTP: 8080 , HTTPS: 443 . (Formerly praqma/network-multitool)
➜  ~ kubectl -n app exec -it network-multitool-frontend-6c5844b654-6hmnp -- curl http://network-multitool-backend:6379
curl: (28) Failed to connect to network-multitool-backend port 6379 after 135301 ms: Couldn't connect to server
command terminated with exit code 28
➜  ~ kubectl -n app exec -it network-multitool-frontend-6c5844b654-6hmnp -- telnet network-multitool-cache 6379
telnet: can't connect to remote host (10.105.199.173): Operation timed out
command terminated with exit code 
```
> backend Видим, что подключается к кэшу и не подключается к фронту
```
➜  ~ kubectl -n app exec -it network-multitool-backend-79bd4c5db8-nwqr4 -- telnet network-multitool-cache 6379 
Connected to network-multitool-cache
Console escape. Commands are:

 l	go to line mode
 c	go to character mode
 z	suspend telnet
 e	exit telnet
continuing...
quit
+OK
Connection closed by foreign host
command terminated with exit code 1
➜  ~ kubectl -n app exec -it network-multitool-backend-79bd4c5db8-nwqr4 -- telnet network-multitool-frontend 80
telnet: can't connect to remote host (10.107.193.149): Operation timed out
command terminated with exit code 1
```